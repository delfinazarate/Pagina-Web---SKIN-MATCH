<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Skin-Match ‚Äî Matches</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fbf3f3;color:#553243;}
  header{background:#fff;border-bottom:1px solid #efd9e1;padding:12px 16px;}
  .header-bar{max-width:1060px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px;}
  .header-left,.header-right{display:flex;align-items:center;gap:10px;}
  .brand{margin:0;font-weight:800;letter-spacing:.5px;color:#9b5670;font-size:28px;text-align:center;}
  .icon-btn{display:inline-flex;align-items:center;justify-content:center;width:38px;height:38px;border-radius:10px;border:1px solid #efd9e1;background:#fff;color:#9b5670;position:relative;text-decoration:none;font-size:18px;}
  .icon-btn:hover{background:#f8e9ef;}
  .badge{position:absolute;top:-6px;right:-6px;min-width:18px;height:18px;padding:0 4px;border-radius:999px;background:#9b5670;color:#fff;font-size:12px;line-height:18px;text-align:center;}

  .nav{display:flex;gap:8px;flex-wrap:wrap;padding:10px 20px;border-bottom:1px solid #efd9e1;background:#fff;justify-content:center;}
  .nav a{padding:8px 12px;border:1px solid #efd9e1;border-radius:999px;background:#fff;font-weight:600;text-decoration:none;color:inherit;}
  .nav a:hover{background:#f8e9ef;}

  .card{background:#fff;border:1px solid #efd9e1;border-radius:16px;padding:20px;margin:30px auto;max-width:720px;box-shadow:0 6px 14px rgba(0,0,0,.06);}
  .btn{display:inline-block;padding:14px 20px;border-radius:10px;background:#9b5670;color:#fff;font-weight:700;border:0;margin-top:14px;cursor:pointer;}
  img.preview{width:100%;max-height:380px;object-fit:cover;border-radius:12px;margin-top:12px;border:1px solid #efd9e1;}
  .hint{color:#7b6671;font-size:14px;margin-top:8px;}

  .result{margin-top:24px;}
  .result h3{margin:6px 0 16px;color:#9b5670;text-align:center;font-size:22px;}
  .products{display:flex;flex-wrap:wrap;gap:14px;justify-content:center;}
  .product{background:#fff;border:1px solid #efd9e1;border-radius:12px;padding:12px;width:180px;box-shadow:0 4px 10px rgba(0,0,0,.05);text-align:center;}
  .product img{width:100%;height:130px;object-fit:cover;border-radius:10px;background:#f4dfe7;border:1px solid #efd9e1;}
  .product strong{display:block;margin:8px 0 2px;color:#9b5670;font-size:16px;}
  .product small{color:#7b6671;display:block;margin-bottom:6px;}
  .price{font-weight:800;margin-bottom:8px;}
  .btn-buy{width:100%;padding:10px 12px;border-radius:10px;background:#9b5670;color:#fff;border:0;font-weight:800;cursor:pointer;}
  .btn-buy:hover{background:#7a455d;}
</style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <div class="header-bar">
      <div class="header-left">
        <a href="preview.html" class="icon-btn" title="Inicio">üè†</a>
      </div>
      <h1 class="brand">SKIN-MATCH</h1>
      <div class="header-right">
        <a href="cart.html" class="icon-btn" title="Carrito">üõí <span class="badge" id="cartCount">0</span></a>
        <a href="profile.html" class="icon-btn" title="Mi perfil">üë§</a>
      </div>
    </div>
  </header>

  <!-- NAV -->
  <nav class="nav">
    <a href="preview.html">Inicio</a>
    <a href="matches.html">Matches</a>
    <a href="reviews.html">Reviews</a>
    <a href="tutorial.html">Tutorial</a>
    <a href="stores.html">Stores</a>
  </nav>

  <!-- MAIN -->
  <main>
    <div class="card">
      <h2 style="margin:0 0 6px; color:#553243;">Sub√≠ o sac√° tu foto üì∏</h2>
      <p>Tomamos tu selfie y te recomendamos productos seg√∫n tu tipo de piel.</p>

      <input type="file" accept="image/*" capture="environment" id="fileInput">
      <img id="preview" class="preview" style="display:none;" alt="preview">

      <button class="btn" id="analyzeBtn" type="button">Analizar mi piel</button>
      <div id="hint" class="hint"></div>

      <div id="result" class="result"></div>
    </div>
  </main>

<script>
  /* ================== CARRITO simple y UNIFICADO ================== */
  function getCart(){ return JSON.parse(localStorage.getItem('cart')||'[]'); }
  function setCart(c){ localStorage.setItem('cart', JSON.stringify(c)); }
  function updateCartBadge(){
    const badge = document.getElementById('cartCount');
    if (badge) badge.textContent = getCart().length;
  }
  document.addEventListener('DOMContentLoaded', updateCartBadge);

  function addToCart(p){
    // normalizo por si faltan claves
    const item = {
      nombre: p.nombre || 'Producto',
      marca : p.marca  || '',
      precio: Number(p.precio)||0,
      img   : p.img    || ''
    };
    const cart = getCart();
    cart.push(item);
    setCart(cart);
    updateCartBadge();
    alert('Agregado al carrito: ' + item.nombre);
  }

  /* ================== MATCHES (preview + recomendaciones) ================== */
  const fileInput  = document.getElementById('fileInput');
  const preview    = document.getElementById('preview');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const hint       = document.getElementById('hint');
  const result     = document.getElementById('result');

  let currentImage = null;

  fileInput.addEventListener('change', e=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      currentImage = ev.target.result;
      preview.src = currentImage;
      preview.style.display = "block";
      result.innerHTML = "";              // limpio recomendaciones
      hint.textContent = "Foto lista. Toc√° ‚ÄúAnalizar mi piel‚Äù.";
    };
    reader.readAsDataURL(file);
  });

  // Productos demo (pod√©s reemplazarlos por la respuesta del backend)
  const PRODUCTOS_DEMO = [
    {nombre:"Hidratante ligera",   marca:"GlowSkin",    precio:15.00, img:"hidratante.jpg"},
    {nombre:"Base Natural",         marca:"Rare Beauty", precio:29.00, img:"tono.jpg"},
    {nombre:"Corrector Iluminador", marca:"Maybelline",  precio:12.00, img:"highlight.jpg"},
    {nombre:"Rubor en crema",       marca:"K-Beauty",    precio:10.00, img:"blushes.jpg"},
    {nombre:"Labial Nude",          marca:"Fenty Beauty",precio:18.00, img:"rhode.jpg"},
    {nombre:"Sombra de ojos",       marca:"Urban Decay", precio:25.00, img:"eyeshadow.jpg"}
  ];

  function renderProducts(items){
    const cards = items.map(p => `
      <div class="product">
        <img src="${p.img}" alt="${p.nombre}" onerror="this.style.background='#f4dfe7';this.removeAttribute('src')">
        <strong>${p.nombre}</strong>
        <small>${p.marca}</small>
        <div class="price">$${p.precio.toFixed(2)}</div>
        <button class="btn-buy" onclick='addToCart(${JSON.stringify(p)})'>üõí Comprar</button>
      </div>
    `).join('');
    result.innerHTML = `<h3>‚ú® Productos recomendados</h3><div class="products">${cards}</div>`;
  }

  analyzeBtn.addEventListener('click', ()=>{
    if(!currentImage){
      alert("Primero sub√≠ o sac√° tu foto.");
      return;
    }
    // ac√° podr√≠as hacer fetch a tu backend; por ahora mostramos demo:
    renderProducts(PRODUCTOS_DEMO);
    hint.textContent = "Listo ‚úÖ. Si sub√≠s otra foto, actualizamos las recomendaciones.";
  });
</script>

</body>
</html>
